# 第 7 回の課題

## 第 6 回講義までに構築したアプリケーションの脆弱性と対応を考えてみる

### EC2 インスタンスもプライベートサブネットに配置する

- パブリックサブネットに配置した EC2 インスタンスをプライベートサブネットに変更する。パブリックサブネットに踏み台サーバーを作成して、このサーバーから EC2 インスタンスにアクセスする。NAT ゲートウェイをパブリックサブネットに設置して、プライベートサブネット内の EC2 インスタンスからインターネットへのアウトバンド通信のみを許可する。
- データベース層に加えてアプリケーション層もプライベートサブネットに配置することで、必要最小限のアクセスのみに限定してより高いセキュリティレベルを維持できる。

### HTTP 通信を HTTPS 通信に変える

- AWS Certificate Manager で SSL/TLS 証明書を発行して、 ALB の HTTPS リスナー にアタッチする。
- HTTPS 通信（43 番ポート） のみを許可するようにセキュリティグループを置き換える。
- HTTP 通信のリクエストを HTTPS 通信へとリダイレクトする ALB のリスナールールを設定する。
- ALB が HTTPS（SSL/TLS）を終端（復号）して、内部サーバーには HTTP で転送する。クライアントと ALB 間の通信は HTTPS で安全に接続しながら、内部サーバーは HTTP のまま運用できる。

### DDoS 攻撃を防ぐ

- AWS WAF のウェブ ACL を使って 特定 IP アドレスからのアクセスをブロックしたり、一定時間内のリクエスト数が閾値を超えた場合にその IP アドレスをブロックするように設定して、大量のリクエスト送信による負荷を防止する。
- より大規模な DDoS 攻撃を防ぐには、 AWS Shield Advanced を利用して SRT チームのサポートを得る。利用料が高額だが、DDoS 攻撃のリクエストに対するコストは補償される。

### アクセスキーの流出を防ぐ

- AWS KMS や AWS Secrets Manager などの AWS が提供している認証情報を安全に管理するサービスを使う。
- IAM ロールなどの流出するリスクがより低い手段が他にないか検討する。
- アクセスキー自体を発行しないようにして、リスクそのものを回避する。発行するにしても権限の範囲を狭くしてリスクを減らす。例えば、ReadOnly にする等。

## 学んだことのメモ

- アプリケーションやインフラに対するセキュリティリスクだけでなく、事業責任者とセキュリティについて話し合って認識を擦り合わせることでリスクの低減を計ることも必要である。
- 非営利団体である OWASP がとくに重大な 10 個のセキュリティインシデントについてまとめているため、必要に応じて参照する。
  - [OWASP TOP 10 のリンク（日本語版）](https://github.com/owasp-ja/Top10/blob/master/2021/docs/index.ja.md)
- IPA（独立処理推進機構）が公表する共通脆弱性評価システムを参考にする。CVSS のデータベースを日本では JVN と呼ぶ。
  - [JVN 脆弱性レポートの読み方](https://jvn.jp/nav/jvnhelp.html)

## 感想

- Amazon Inspector に自動修復機能が無いという情報は、SAA の本試験でその文言ごと出題があったので、資格勉強と繋がりを意識できて学習意欲に対するモチベーションが高まりました。
- 認証情報については、実際に講義の中で IAM ユーザーのアクセスキーと環境変数を記述したので、身近にあるリスクとして感じられました。
- AWS Secrets Manager は、自動ローテーション機能の有無で Systems Manager と比較されることがあったので、要件に応じて最適なサービスを選択・提案できるようになる事を目指すことが極めて重要だと思いました。
